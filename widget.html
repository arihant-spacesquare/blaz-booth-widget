import React, { useEffect, useState, useRef } from 'react';

const Index = () => {
  const [chatReady, setChatReady] = useState(false);
  const [guideVisible, setGuideVisible] = useState(true);
  const dfMessengerRef = useRef(null); // Ref to hold the df-messenger element

  useEffect(() => {
    // Initialize Dialogflow Messenger script
    const script = document.createElement('script');
    script.src = 'https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js';
    script.async = true;
    document.body.appendChild(script);

    // Create and insert the df-messenger element
    const dfMessenger = document.createElement('df-messenger');
    dfMessenger.setAttribute('project-id', 'blaz-request-booth');
    dfMessenger.setAttribute('agent-id', 'ad471477-3a50-4b3f-9d3a-3b52bf715469');
    dfMessenger.setAttribute('language-code', 'en');
    dfMessenger.setAttribute('max-query-length', '-1');
    dfMessenger.setAttribute('id', 'df-messenger');

    // Create chat bubble element
    const chatBubble = document.createElement('df-messenger-chat-bubble');
    chatBubble.setAttribute('chat-title', 'Bläz Booth Agent');
    dfMessenger.appendChild(chatBubble);

    // Append df-messenger to body and set up event listeners
    script.onload = () => {
      document.body.appendChild(dfMessenger);
      dfMessengerRef.current = dfMessenger; // Store ref to the actual DOM element

      // Small delay to ensure messenger is fully rendered before setting ready
      setTimeout(() => {
        setChatReady(true);
        // Add data-ready attribute for CSS animations
        dfMessenger.setAttribute('data-ready', 'true');
      }, 1000);

      dfMessenger.addEventListener('df-messenger-opened', () => {
        setGuideVisible(false);
      });

      dfMessenger.addEventListener('df-messenger-close', () => {
        setGuideVisible(true);
      });
    };

    return () => {
      // Clean up
      document.body.removeChild(script);
      if (dfMessengerRef.current && document.body.contains(dfMessengerRef.current)) {
        document.body.removeChild(dfMessengerRef.current);
      }
    };
  }, []);

  return (
    <div className="relative min-h-screen w-full overflow-hidden bg-[#0a0a0e] text-white"> {/* Dark background, white text by default */}
      {/* Background effects similar to image_896ec3.png */}
      <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxIiBjeT0iMSIgcj0iMSIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC4wNSIvPjwvc3ZnPg==')] opacity-40"></div>
      
      {/* Decorative glow effects that mimic club lighting from image_896ec3.png */}
      <div className="absolute top-20 left-1/4 h-64 w-64 rounded-full bg-purple-600/20 blur-[100px] animate-pulse"></div>
      <div className="absolute bottom-12 right-1/3 h-80 w-80 rounded-full bg-blue-500/20 blur-[100px] animate-pulse"></div>
      <div className="absolute top-1/3 right-1/4 h-56 w-56 rounded-full bg-pink-500/10 blur-[80px] animate-pulse"></div>
      
      {/* Main content - Centered within a card-like structure from image_896ec3.png */}
      <div className="flex flex-col items-center justify-center w-full min-h-screen px-4 py-16 z-10"> {/* Increased z-index to ensure content is above glows */}
        <div className="max-w-lg w-full text-center p-8 rounded-2xl backdrop-blur-xl bg-black/30 border border-white/10 shadow-xl"> {/* Recreated Card-like style */}
          <div className="pt-6">
            <div className="mb-6 flex justify-center">
              <div className="inline-flex h-20 w-20 items-center justify-center rounded-full bg-gradient-to-r from-purple-600 via-blue-500 to-violet-500 shadow-lg shadow-purple-500/30 p-0.5">
                <div className="h-full w-full rounded-full bg-black/80 flex items-center justify-center">
                  <div className="h-14 w-14 relative">
                    {/* Icon similar to image_896ec3.png, using a microphone icon like image_8898b1.png */}
                    <svg viewBox="0 0 24 24" className="w-full h-full text-purple-500 fill-current">
                      <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.2-3c0 3.53-2.93 6.43-6.2 6.43S4.8 14.53 4.8 11H3c0 4.84 3.44 8.87 8 9.8V23h2v-2.17c4.56-.93 8-4.96 8-9.8h-1.8z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
            
            <h1 className="font-playfair text-4xl font-bold mb-4 text-white tracking-tight">
              Bläz Booth Agent
            </h1>
            
            <p className="text-gray-300 font-light text-lg mb-4 leading-relaxed">
              This is your dedicated portal for requesting an exclusive VIP booth
              for an upcoming <span className="bg-gradient-to-r from-purple-400 via-pink-500 to-blue-400 bg-clip-text text-transparent font-medium">Bläz Entertainment</span> event.
            </p>
            <p className="text-gray-300 font-light text-lg mb-8 leading-relaxed">
              Use the chat at the <span className="font-medium">"bottom right"</span> to request a booth — a Bläz team member will call to confirm.
            </p>
            
            <div className="flex flex-col items-center space-y-4">
              <div className="w-32 h-1 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full"></div>
              <div className="text-sm text-gray-400 italic">
                The ultimate social experience awaits you
              </div>
            </div>
          </div>
        </div>
      </div>
      
      {/* Bottom right guide from image_896ec3.png, image_88a00c.png, image_8898b1.png, image_8882c5.png */}
      <div 
        className={`fixed bottom-28 right-8 z-[998] max-w-[180px] text-right transition-all duration-500 transform ${
          guideVisible && chatReady ? 'opacity-100 translate-x-0' : 'opacity-0 translate-x-8'
        }`}
      >
        <div className="relative">
          <div className="bg-white/10 backdrop-blur-md p-3 rounded-lg border border-purple-500/30 shadow-lg shadow-purple-500/20">
            <p className="text-sm font-medium text-white mb-1">
              <span className="bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent font-bold">
                CLICK HERE
              </span>
            </p>
            <p className="text-xs text-gray-300">
              Chat with our AI to request your VIP booth
            </p>
          </div>
          {/* Arrow pointing to the chat bubble, similar to previous designs */}
          <div className="absolute -bottom-5 -right-1 w-16 h-16 animate-pulse">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M22 42L42 22" stroke="#8B5CF6" strokeWidth="3" strokeLinecap="round"/>
              <path d="M24 22H42V40" stroke="#8B5CF6" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
          </div>
        </div>
      </div>
      
      {/* Pulsing chat button indicator ring - to draw attention */}
      <div 
        className={`fixed bottom-24 right-24 z-[997] w-16 h-16 rounded-full transition-all duration-500 ${
          guideVisible && chatReady ? 'opacity-100' : 'opacity-0'
        }`}
      >
        <div className="absolute inset-0 rounded-full bg-gradient-to-r from-purple-600 to-blue-500 opacity-70 animate-ping"></div>
        <div className="absolute inset-2 rounded-full bg-gradient-to-r from-purple-600 to-blue-500 opacity-50 animate-pulse"></div>
      </div>
      
      {/* Custom styling for Dialogflow Messenger */}
      <style jsx>{`
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;700&family=Cinzel:wght@400;700&family=Bebas+Neue&display=swap');

        .font-playfair { font-family: 'Playfair Display', serif; }
        .font-montserrat { font-family: 'Montserrat', sans-serif; }
        .font-bebas-neue { font-family: 'Bebas Neue', sans-serif; }

        df-messenger {
          z-index: 999;
          position: fixed;
          bottom: 24px;
          right: 24px;
          --df-messenger-font-family: 'Montserrat', sans-serif;
          --df-messenger-chat-background: #0a0a0e; /* Darker chat background */
          --df-messenger-message-user-background: #8B5CF6; /* Purple message background */
          --df-messenger-message-user-color: white;
          --df-messenger-message-bot-background: #2a2a2a; /* Darker bot message background */
          --df-messenger-message-bot-color: #ffffff; /* White bot message color */
          --df-messenger-button-background-color: #ffeb3b; /* Accent button color */
          --df-messenger-button-box-shadow: 0 4px 20px rgba(255, 235, 59, 0.4);
          --df-messenger-chat-bubble-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
          border-radius: 50%;
          transition: transform 0.3s ease-in-out;
          --df-messenger-header-background: #1a1a1a;
          --df-messenger-header-font-color: #ffffff;
        }

        df-messenger[data-ready="true"]::part(df-messenger-button) {
          animation: pulseChatBubble 2s infinite;
        }

        @keyframes pulseChatBubble {
          0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); }
          50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
          100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }

        /* Add message styles within the chat */
        df-messenger-message {
          --df-messenger-message-border-radius: 12px;
          --df-messenger-message-padding: 12px 16px;
        }

        /* Custom keyframes for glows and icon bounce */
        @keyframes animate-pulse {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.02); }
        }

        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
      `}</style>
    </div>
  );
};

export default Index;
