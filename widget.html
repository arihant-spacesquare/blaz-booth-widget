<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bläz Booth Request Widget</title>
    <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
    <style>
        body {
            font-family: 'Google Sans', sans-serif; /* A clean, modern font */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Ensures content takes full viewport height */
            background-color: #f0f4f8; /* Light background for contrast */
            color: #333;
            flex-direction: column; /* Arrange items vertically */
        }

        /* Styling for the main content area */
        .container {
            text-align: center;
            padding: 40px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
            max-width: 600px;
            margin-bottom: 20px; /* Space above the widget for the button */
        }

        h1 {
            color: #1a73e8; /* Google Blue */
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        p {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #555;
        }

        /* Button Styling - This is our new direct launch button */
        .launch-button {
            background-color: #1a73e8; /* Google Blue */
            color: white;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            text-decoration: none; /* In case it's an <a> tag */
            display: inline-block; /* Allows padding and vertical alignment */
            margin-top: 20px; /* Space below text */
        }

        .launch-button:hover {
            background-color: #1565c0; /* Darker blue on hover */
            transform: translateY(-2px); /* Slight lift effect */
        }

        .launch-button:active {
            transform: translateY(0); /* Press effect */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Dialogflow Messenger Widget Styling - Reverted for visibility */
        df-messenger {
            z-index: 999;
            position: fixed; /* Stays in place when scrolling */
            --df-messenger-font-color: #000;
            --df-messenger-font-family: 'Google Sans', sans-serif;
            --df-messenger-chat-background: #f3f6fc; /* Light background for chat window */
            --df-messenger-message-user-background: #d3e3fd; /* User bubble blue */
            --df-messenger-message-bot-background: #fff; /* Bot bubble white */
            bottom: 16px;
            right: 16px;
            /* IMPORTANT: We are NOT setting display: none; here anymore.
               The widget should be visible by default as intended by Dialogflow Messenger. */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome to the Bläz Booth Booking Portal!</h1>
        <p>
            Ready to secure your perfect spot at an upcoming Bläz event? Our interactive **Bläz Booth Agent** is here to guide you through the process quickly and efficiently.
        </p>
        <p>
            Simply click the button below to instantly launch our chat assistant. It will walk you through collecting all the necessary details for your booth request. Once submitted, a dedicated Bläz team member will be in touch to confirm everything personally!
        </p>
        <button id="requestBoothButton" class="launch-button">
            Click to Request a Booth at a Bläz Event!
        </button>
    </div>

    <df-messenger
        project-id="blaz-request-booth"
        agent-id="ad471477-3a50-4b3f-9d3a-3b52bf715469"
        language-code="en"
        max-query-length="-1"
        id="df-messenger">
        <df-messenger-chat-bubble chat-title="Bläz Booth Agent"></df-messenger-chat-bubble>
    </df-messenger>

    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

    <script>
        window.addEventListener('load', function() {
            const dfMessenger = document.getElementById('df-messenger');
            const requestBoothButton = document.getElementById('requestBoothButton');

            if (dfMessenger && requestBoothButton) {
                // Ensure the Dialogflow messenger is ready before interacting
                const waitForDfMessengerReady = setInterval(() => {
                    // Check if the internal shadow DOM elements are loaded
                    // We specifically look for the chat bubble within the shadow DOM to ensure it's ready.
                    const chatBubbleInShadow = dfMessenger.shadowRoot?.querySelector('df-messenger-chat-bubble');

                    if (chatBubbleInShadow) {
                        clearInterval(waitForDfMessengerReady); // Stop polling

                        // Attach click listener to our custom button
                        requestBoothButton.addEventListener('click', function() {
                            console.log('Custom button clicked! Opening df-messenger and sending initial message.');

                            // Force the chat window to expand
                            dfMessenger.setAttribute('expand', 'true');

                            // Send an empty message to trigger the bot's welcome intent
                            // This also implicitly opens the chat if not already open
                            dfMessenger.sendMessage('');

                            // Hide the custom button after it's clicked and the chat is opened
                            requestBoothButton.style.display = 'none';
                        });

                        // Add listener to show the button again if the df-messenger is closed
                        dfMessenger.addEventListener('df-messenger-close', () => {
                            console.log('df-messenger closed.');
                            requestBoothButton.style.display = 'inline-block'; // Show button again
                        });

                    }
                }, 100); // Check every 100ms for df-messenger to be fully loaded
            } else {
                console.error('df-messenger or requestBoothButton element not found');
            }
        });
    </script>
</body>
</html>
